<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tudor Popescu\Desktop\I.NET\Project\VetExpert\VetExpert\VetExpert.IntegrationTesting\CustomWebApplicationFactory.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Mvc.Testing;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using VetExpert.Infrastructure;


using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Mvc.Testing;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Microsoft.VisualStudio.TestPlatform.CommunicationUtilities;
using VetExpert.Infrastructure;
namespace VetExpert.IntegrationTesting
{
    public class CustomWebApplicationFactory&lt;TStartup&gt; : WebApplicationFactory&lt;TStartup&gt;
         where TStartup : class
    {
        protected override void ConfigureWebHost(IWebHostBuilder builder)
        {
            builder.ConfigureServices(services =&gt;
            {
                var descriptor = services.SingleOrDefault(
                    d =&gt; d.ServiceType ==
                         typeof(DbContextOptions&lt;MainDbContext&gt;));
                if (descriptor != null)
                {
                    services.Remove(descriptor);
                }

                services.AddDbContext&lt;MainDbContext&gt;(options =&gt;
                {
                    options.UseInMemoryDatabase(&quot;InMemoryDbForTesting&quot;);
                });

                var sp = services.BuildServiceProvider();

                using (var scope = sp.CreateScope())
                {
                    var scopedServices = scope.ServiceProvider;
                    var db = scopedServices.GetRequiredService&lt;MainDbContext&gt;();
                  

                    db.Database.EnsureDeleted();

                    db.Database.EnsureCreated();
                   DbSeeding.ReinitializeDbForTests(db);
                   //DbSeeding.InitializeDbForTests(db);

                }
            });
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[25,9,25,10,1],[26,13,27,13,1],[27,13,27,14,1],[27,14,28,17,1],[28,17,29,26,1],[29,26,30,65,1],[30,65,30,67,1],[30,67,31,17,1],[31,17,31,40,1],[31,40,32,17,1],[32,17,32,18,1],[32,18,33,21,1],[33,21,33,49,1],[33,49,34,17,1],[34,17,34,18,1],[34,18,36,17,1],[36,17,37,17,1],[37,17,37,18,1],[37,18,38,21,1],[38,21,38,73,1],[38,73,39,17,1],[39,17,39,18,1],[39,18,39,20,1],[39,20,41,17,1],[41,17,41,58,1],[41,58,43,24,1],[43,24,43,52,1],[43,52,44,17,1],[44,17,44,18,1],[44,18,45,21,1],[45,21,45,64,1],[45,64,46,21,1],[46,21,46,81,1],[46,81,49,21,1],[49,21,49,49,1],[49,49,51,21,1],[51,21,51,49,1],[51,49,52,20,1],[52,20,52,57,1],[52,57,55,17,1],[55,17,55,18,1],[55,18,56,13,1],[56,13,56,14,1],[56,14,56,16,1],[57,9,57,10,1]]);
    </script>
  </body>
</html>