<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Tudor Popescu\Desktop\I.NET\Project\VetExpert\VetExpert\VetExpert.IntegrationTesting\UserControllerTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using FluentAssertions;
using Newtonsoft.Json;
using System.Net.Http.Json;
using VetExpert.API.Dto;
using Xunit;

namespace VetExpert.IntegrationTesting
{
    [Collection(&quot;Database tests&quot;)]
    public class UserControllerTests :  IDisposable
    {
        
        private const string ApiURL = &quot;/api/User&quot;;

        [Fact]
        public async void When_CreatedUser_Then_ShouldReturnUserInTheGetRequest()
        {
            var http_client = new CustomWebApplicationFactory&lt;Program&gt;().CreateClient();
            //Dispose();
            CreateUserDto userDto = CreateSUT();
            CreateUserDto userDto1 = CreateSUT();
            // Act
            var createUserResponse = await http_client.PostAsJsonAsync(ApiURL, userDto);
            var createUserResponse1 = await http_client.PostAsJsonAsync(ApiURL, userDto1);
            // Assert
            createUserResponse.EnsureSuccessStatusCode();
            createUserResponse.StatusCode.Should().Be(System.Net.HttpStatusCode.Created);

           createUserResponse1.EnsureSuccessStatusCode();
           createUserResponse1.StatusCode.Should().Be(System.Net.HttpStatusCode.Created);
            var getUserResult = await http_client.GetStringAsync(ApiURL);
            // Assert
           

            var users = JsonConvert.DeserializeObject&lt;List&lt;CreateUserDto&gt;&gt;(getUserResult);

            users.Count.Should().Be(3);
            users.Should().HaveCount(3);
            users.Should().NotBeNull();

            Dispose();
        }

        private static CreateUserDto CreateSUT()
        {
            // Arrange
            return new CreateUserDto
            {
                Name = &quot;user 1&quot;,
                Address=&quot;my address&quot;,
                Email= &quot;myemail@email&quot;,
                PhoneNumber=&quot;***&quot;
                
            };
        }

        public void Dispose()
        {
            //CleanDatabases();
        }
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[17,9,17,10,1],[18,13,18,89,1],[20,13,20,49,1],[21,13,21,50,1],[23,13,23,89,1],[24,13,24,91,1],[26,13,26,58,1],[27,13,27,90,1],[29,12,29,58,1],[30,12,30,90,1],[31,13,31,74,1],[35,13,35,91,1],[37,13,37,40,1],[38,13,38,41,1],[39,13,39,40,1],[41,13,41,23,1],[42,9,42,10,1],[45,9,45,10,1],[47,13,54,15,1],[55,9,55,10,1],[58,9,58,10,1],[60,9,60,10,1]]);
    </script>
  </body>
</html>